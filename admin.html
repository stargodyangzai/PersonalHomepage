<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全能内容管理后台 (Pro v3)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .input-std { width: 100%; border: 1px solid #e5e7eb; padding: 0.5rem; border-radius: 0.375rem; outline: none; font-size: 0.875rem; transition: all 0.2s; }
        .input-std:focus { border-color: #3b82f6; ring: 2px; }
        .label-tiny { font-size: 0.75rem; font-weight: 700; color: #6b7280; text-transform: uppercase; margin-bottom: 0.25rem; display: block; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 md:p-6">
    <div class="max-w-[1400px] mx-auto bg-white rounded-xl shadow-2xl overflow-hidden flex flex-col h-[90vh]">
        <!-- 头部 -->
        <div class="bg-slate-800 text-white p-4 flex justify-between items-center shrink-0">
            <h1 class="text-lg font-bold"><i class="fa-solid fa-sliders mr-2"></i>Admin Pro v3</h1>
            <div class="flex gap-3">
                <button onclick="downloadBackup()" class="px-4 py-2 bg-gray-700 rounded text-sm font-bold hover:bg-gray-600">备份</button>
                <button onclick="saveChanges()" class="px-6 py-2 bg-green-600 rounded text-sm font-bold hover:bg-green-500 shadow-lg">保存</button>
            </div>
        </div>

        <!-- 导航 -->
        <div class="flex border-b overflow-x-auto shrink-0 bg-gray-50 no-scrollbar">
            <button onclick="switchTab('info')" id="tab-info" class="tab-btn px-6 py-4 text-sm font-bold border-r border-b-2 border-b-blue-600 bg-white text-blue-600">基本信息</button>
            <button onclick="switchTab('projects')" id="tab-projects" class="tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100">项目</button>
            <button onclick="switchTab('experience')" id="tab-experience" class="tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100">经历</button>
            <button onclick="switchTab('opensource')" id="tab-opensource" class="tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100">开源</button>
            <button onclick="switchTab('stack')" id="tab-stack" class="tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100">技术栈</button>
            <button onclick="switchTab('socials')" id="tab-socials" class="tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100">社交链接</button>
        </div>

        <!-- 内容区域 -->
        <div class="flex-1 overflow-hidden relative bg-white">
            
            <!-- Info -->
            <div id="view-info" class="view-section h-full overflow-y-auto p-8">
                <div class="max-w-4xl mx-auto space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="label-tiny">显示名称</label><input class="input-std" id="info-name" oninput="data.info.name=this.value"></div>
                        <div><label class="label-tiny">Email</label><input class="input-std" id="info-email" oninput="data.info.email=this.value"></div>
                    </div>
                    <div><label class="label-tiny">头像路径 (./images/xx.jpg)</label><input class="input-std bg-gray-50" id="info-avatar" oninput="data.info.avatar=this.value; document.getElementById('preview-avt').src=this.value"></div>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="label-tiny">中文头衔</label><input class="input-std" id="info-titleZH" oninput="data.info.titleZH=this.value"></div>
                        <div><label class="label-tiny">英文头衔</label><input class="input-std" id="info-titleEN" oninput="data.info.titleEN=this.value"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="label-tiny">中文简介</label><textarea class="input-std" rows="3" id="info-descZH" oninput="data.info.descZH=this.value"></textarea></div>
                        <div><label class="label-tiny">英文简介</label><textarea class="input-std" rows="3" id="info-descEN" oninput="data.info.descEN=this.value"></textarea></div>
                    </div>
                    <img id="preview-avt" src="" class="w-16 h-16 rounded-full border object-cover">
                </div>
            </div>

            <!-- Projects -->
            <div id="view-projects" class="view-section h-full flex hidden">
                <div class="w-72 border-r bg-gray-50 flex flex-col">
                    <div class="p-4 border-b"><button onclick="addProject()" class="w-full py-2 bg-blue-600 text-white text-sm font-bold rounded hover:bg-blue-700 shadow">+ 新建项目</button></div>
                    <div id="list-projects" class="flex-1 overflow-y-auto p-2 space-y-1"></div>
                </div>
                <div class="flex-1 overflow-y-auto p-8" id="form-projects">
                    <div class="h-full flex items-center justify-center text-gray-400">请选择项目</div>
                </div>
            </div>

            <!-- Experience (Updated for Dual Time) -->
            <div id="view-experience" class="view-section h-full p-8 overflow-y-auto hidden">
                <div class="max-w-4xl mx-auto">
                    <button onclick="addExperience()" class="px-4 py-2 bg-blue-100 text-blue-700 font-bold rounded text-sm mb-6 hover:bg-blue-200">+ 新增经历</button>
                    <div id="list-experience" class="space-y-4"></div>
                </div>
            </div>

            <!-- OpenSource -->
            <div id="view-opensource" class="view-section h-full p-8 overflow-y-auto hidden">
                <div class="max-w-5xl mx-auto">
                    <button onclick="addOpenSource()" class="px-4 py-2 bg-blue-100 text-blue-700 font-bold rounded text-sm mb-6 hover:bg-blue-200">+ 新增记录</button>
                    <div id="list-opensource" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
                </div>
            </div>

            <!-- Stack -->
            <div id="view-stack" class="view-section h-full p-8 overflow-y-auto hidden">
                <div class="max-w-4xl mx-auto">
                    <button onclick="addStackCat()" class="px-4 py-2 bg-blue-100 text-blue-700 font-bold rounded text-sm mb-6 hover:bg-blue-200">+ 新增分类</button>
                    <div id="list-stack" class="space-y-6"></div>
                </div>
            </div>

            <!-- Socials -->
            <div id="view-socials" class="view-section h-full p-8 overflow-y-auto hidden">
                <div class="max-w-5xl mx-auto">
                    <button onclick="addSocial()" class="px-4 py-2 bg-blue-100 text-blue-700 font-bold rounded text-sm mb-6 hover:bg-blue-200">+ 新增链接</button>
                    <div id="list-socials" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
                </div>
            </div>
        </div>
    </div>
    
    <a id="download-anchor" class="hidden"></a>
    <script src="data.js"></script>
    <script>
        let data = window.portfolioData;
        let projectEditIndex = -1;
        let fileHandle = null;

        const iconMap = {
            "fa-brands fa-github": "GitHub",
            "fa-solid fa-envelope": "Email (邮箱)",
            "fa-brands fa-zhihu": "知乎 (Zhihu)",
            "fa-brands fa-bilibili": "Bilibili",
            "fa-brands fa-twitter": "Twitter / X",
            "fa-brands fa-linkedin": "LinkedIn",
            "fa-solid fa-camera-retro": "小红书 (相机)",
            "fa-brands fa-weixin": "微信 (WeChat)",
            "fa-solid fa-link": "其他链接"
        };

        document.addEventListener('DOMContentLoaded', () => {
            switchTab('info');
            ['name', 'email', 'avatar', 'titleZH', 'titleEN', 'descZH', 'descEN'].forEach(key => {
                if(document.getElementById(`info-${key}`)) document.getElementById(`info-${key}`).value = data.info[key] || '';
            });
            document.getElementById('preview-avt').src = data.info.avatar;
        });

        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                if(btn.id === `tab-${tab}`) {
                    btn.className = "tab-btn px-6 py-4 text-sm font-bold border-r border-b-2 border-b-blue-600 bg-white text-blue-600 transition";
                } else {
                    btn.className = "tab-btn px-6 py-4 text-sm font-bold border-r text-gray-500 hover:bg-gray-100 transition";
                }
            });
            if(tab === 'projects') renderProjectList();
            if(tab === 'experience') renderExperience();
            if(tab === 'stack') renderStack();
            if(tab === 'opensource') renderOpenSource();
            if(tab === 'socials') renderSocials();
        }

        // Projects
        function renderProjectList() {
            document.getElementById('list-projects').innerHTML = data.projects.map((p, idx) => `
                <div class="flex items-center gap-1 mb-1 group">
                    <div class="flex flex-col gap-0.5 opacity-30 group-hover:opacity-100 transition">
                        <button onclick="moveItem('projects', ${idx}, -1); event.stopPropagation()" class="text-[10px] hover:text-blue-600 px-1">▲</button>
                        <button onclick="moveItem('projects', ${idx}, 1); event.stopPropagation()" class="text-[10px] hover:text-blue-600 px-1">▼</button>
                    </div>
                    <div onclick="editProject(${idx})" class="flex-1 p-3 rounded cursor-pointer truncate border hover:bg-blue-50 ${projectEditIndex===idx ? 'bg-blue-100 font-bold text-blue-700' : 'bg-white'}">
                        ${p.titleZH || '未命名'}
                    </div>
                </div>
            `).join('');
        }
        function editProject(idx) {
            projectEditIndex = idx;
            renderProjectList();
            const p = data.projects[idx];
            document.getElementById('form-projects').innerHTML = `
                <div class="space-y-6">
                    <div class="flex justify-between border-b pb-2"><h3 class="font-bold">编辑项目</h3><button onclick="data.projects.splice(${idx},1);projectEditIndex=-1;document.getElementById('form-projects').innerHTML='';renderProjectList()" class="text-red-500 text-sm">删除</button></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="label-tiny">中文标题</label><input class="input-std" value="${p.titleZH||''}" oninput="data.projects[${idx}].titleZH=this.value;renderProjectList()"></div>
                        <div><label class="label-tiny">英文标题</label><input class="input-std" value="${p.titleEN||''}" oninput="data.projects[${idx}].titleEN=this.value"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="label-tiny">中文标签</label><input class="input-std" value="${(p.tagsZH||[]).join(',')}" onchange="data.projects[${idx}].tagsZH=this.value.split(/[,，]/)"></div>
                        <div><label class="label-tiny">英文标签</label><input class="input-std" value="${(p.tagsEN||[]).join(',')}" onchange="data.projects[${idx}].tagsEN=this.value.split(/[,，]/)"></div>
                    </div>
                    <div><label class="label-tiny">分类</label><input class="input-std" value="${p.category||''}" oninput="data.projects[${idx}].category=this.value"></div>
                    <div><label class="label-tiny">封面图</label><input class="input-std bg-gray-50" value="${p.image||''}" oninput="data.projects[${idx}].image=this.value"></div>
                    <div><label class="label-tiny">链接</label><input class="input-std text-blue-600" value="${p.link||''}" oninput="data.projects[${idx}].link=this.value"></div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="label-tiny">中文简介</label><textarea class="input-std" rows="2" oninput="data.projects[${idx}].descZH=this.value">${p.descZH||''}</textarea></div>
                        <div><label class="label-tiny">英文简介</label><textarea class="input-std" rows="2" oninput="data.projects[${idx}].descEN=this.value">${p.descEN||''}</textarea></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="label-tiny">中文详情 (Markdown)</label><textarea class="input-std h-40 font-mono" oninput="data.projects[${idx}].detailZH=this.value">${p.detailZH||''}</textarea></div>
                        <div><label class="label-tiny">英文详情 (Markdown)</label><textarea class="input-std h-40 font-mono" oninput="data.projects[${idx}].detailEN=this.value">${p.detailEN||''}</textarea></div>
                    </div>
                </div>`;
        }
        function addProject() { data.projects.push({id:Date.now(), titleZH:"新项目", tagsZH:[], tagsEN:[]}); renderProjectList(); editProject(data.projects.length-1); }

        // Experience (Supports timeZH/timeEN)
        function renderExperience() {
            document.getElementById('list-experience').innerHTML = data.experience.map((e, idx) => `
                <div class="border rounded p-4 bg-gray-50 relative flex gap-4 group hover:shadow-md transition">
                    <div class="flex flex-col gap-1 pt-1 opacity-30 group-hover:opacity-100 transition">
                        <button onclick="moveItem('experience', ${idx}, -1)" class="text-xs hover:text-blue-600 bg-white border p-1 rounded">▲</button>
                        <button onclick="moveItem('experience', ${idx}, 1)" class="text-xs hover:text-blue-600 bg-white border p-1 rounded">▼</button>
                    </div>
                    <div class="flex-1">
                        <button onclick="data.experience.splice(${idx},1);renderExperience()" class="absolute top-2 right-2 text-red-500"><i class="fa fa-trash"></i></button>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <input placeholder="中文职位" class="input-std font-bold" value="${e.roleZH||''}" oninput="data.experience[${idx}].roleZH=this.value">
                            <input placeholder="英文职位" class="input-std font-bold" value="${e.roleEN||''}" oninput="data.experience[${idx}].roleEN=this.value">
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <input placeholder="公司(中)" class="input-std" value="${e.companyZH||''}" oninput="data.experience[${idx}].companyZH=this.value">
                            <input placeholder="公司(英)" class="input-std" value="${e.companyEN||''}" oninput="data.experience[${idx}].companyEN=this.value">
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <input placeholder="时间(中) 2025.9-至今" class="input-std" value="${e.timeZH||''}" oninput="data.experience[${idx}].timeZH=this.value">
                            <input placeholder="时间(英) Sep 2025 - Present" class="input-std" value="${e.timeEN||''}" oninput="data.experience[${idx}].timeEN=this.value">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <textarea placeholder="描述(中)" class="input-std" oninput="data.experience[${idx}].descZH=this.value">${e.descZH||''}</textarea>
                            <textarea placeholder="描述(英)" class="input-std" oninput="data.experience[${idx}].descEN=this.value">${e.descEN||''}</textarea>
                        </div>
                    </div>
                </div>`).join('');
        }
        function addExperience() { data.experience.push({}); renderExperience(); }

        // OpenSource
        function renderOpenSource() {
            document.getElementById('list-opensource').innerHTML = data.opensource.map((o,i)=>`
                <div class="border p-4 mb-2 rounded relative bg-gray-50">
                    <button onclick="data.opensource.splice(${i},1);renderOpenSource()" class="absolute top-2 right-2 text-red-500"><i class="fa fa-times"></i></button>
                    <div class="mb-2"><label class="label-tiny">仓库名</label><input class="input-std font-bold" value="${o.repo}" oninput="data.opensource[${i}].repo=this.value"></div>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <div><label class="label-tiny">中文描述</label><input class="input-std" value="${o.descZH||''}" oninput="data.opensource[${i}].descZH=this.value"></div>
                        <div><label class="label-tiny">英文描述</label><input class="input-std" value="${o.descEN||''}" oninput="data.opensource[${i}].descEN=this.value"></div>
                    </div>
                    <div class="flex gap-2 mb-2">
                        <div><label class="label-tiny">角色(中)</label><input class="input-std text-xs" value="${o.roleZH||''}" oninput="data.opensource[${i}].roleZH=this.value"></div>
                        <div><label class="label-tiny">角色(英)</label><input class="input-std text-xs" value="${o.roleEN||''}" oninput="data.opensource[${i}].roleEN=this.value"></div>
                    </div>
                    <div><label class="label-tiny">链接</label><input class="input-std text-blue-600" value="${o.link||''}" oninput="data.opensource[${i}].link=this.value"></div>
                </div>`).join(''); 
        }
        function addOpenSource(){ data.opensource.push({repo:"",descZH:"",descEN:"",roleZH:"",roleEN:"",link:""}); renderOpenSource(); }

        // Stack & Socials
        function renderStack() { document.getElementById('list-stack').innerHTML = data.stack.map((c,i)=>`<div class="border p-4 mb-2 rounded relative"><button onclick="data.stack.splice(${i},1);renderStack()" class="absolute top-2 right-2 text-red-500"><i class="fa fa-trash"></i></button><div class="grid grid-cols-2 gap-2 mb-2"><input class="input-std" value="${c.categoryZH}" oninput="data.stack[${i}].categoryZH=this.value"><input class="input-std" value="${c.categoryEN}" oninput="data.stack[${i}].categoryEN=this.value"></div><textarea class="input-std" onchange="data.stack[${i}].items=this.value.split(/[,，]/)">${c.items.join(',')}</textarea></div>`).join(''); }
        function addStackCat(){ data.stack.push({categoryZH:"新分类",categoryEN:"New",items:[]}); renderStack(); }

        function renderSocials() { document.getElementById('list-socials').innerHTML = data.socials.map((s,i)=>`
            <div class="border p-3 rounded relative flex gap-3 items-start bg-gray-50">
                <button onclick="data.socials.splice(${i},1);renderSocials()" class="absolute top-1 right-1 text-red-500"><i class="fa fa-times"></i></button>
                <div class="w-10 h-10 flex items-center justify-center bg-white border rounded text-xl shrink-0"><i class="${s.icon} text-gray-700"></i></div>
                <div class="flex-1 space-y-2">
                    <input class="input-std text-xs font-bold" placeholder="名称" value="${s.name}" oninput="data.socials[${i}].name=this.value">
                    <div class="flex gap-1">
                        <input class="input-std text-xs font-mono text-gray-500" id="social-icon-${i}" value="${s.icon}" oninput="data.socials[${i}].icon=this.value; renderSocials()">
                        <select class="border rounded text-xs w-20" onchange="document.getElementById('social-icon-${i}').value=this.value; data.socials[${i}].icon=this.value; renderSocials()">
                            <option value="">选图标</option>${Object.entries(iconMap).map(([cls, name]) => `<option value="${cls}">${name}</option>`).join('')}
                        </select>
                    </div>
                    <input class="input-std text-xs text-blue-600" placeholder="URL" value="${s.link}" oninput="data.socials[${i}].link=this.value">
                </div>
            </div>`).join(''); 
        }
        function addSocial(){ data.socials.push({name:"New",icon:"fa-solid fa-link",link:""}); renderSocials(); }

        function moveItem(key, idx, dir) {
            const arr = data[key]; const newIdx = idx + dir;
            if (newIdx < 0 || newIdx >= arr.length) return;
            [arr[idx], arr[newIdx]] = [arr[newIdx], arr[idx]];
            if (key === 'projects') renderProjectList();
            if (key === 'experience') renderExperience();
        }

        async function saveChanges() {
            const str = `window.portfolioData = ${JSON.stringify(data, null, 4)};`;
            try { if('showSaveFilePicker' in window){ if(!fileHandle) fileHandle=await window.showSaveFilePicker({suggestedName:'data.js'}); const w=await fileHandle.createWritable(); await w.write(str); await w.close(); alert('Saved!'); } else { downloadString(str, 'data.js'); } } catch(e){ if(e.name!=='AbortError') downloadString(str,'data.js'); }
        }
        function downloadBackup() { downloadString(`window.portfolioData = ${JSON.stringify(data, null, 4)};`, `backup_${Date.now()}.js`); }
        function downloadString(c, n) { const a = document.getElementById('download-anchor'); a.href = URL.createObjectURL(new Blob([c],{type:'text/javascript'})); a.download = n; a.click(); }
    </script>
</body>
</html>
